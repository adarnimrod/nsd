---
- hosts: nsd-openbsd
  gather_facts: false
  roles: [openbsd-bootstrap]

- hosts: nsd-xenial
  gather_facts: false
  roles: [debian-bootstrap]

- hosts: all
  strategy: free
  roles:
    - role: nsd
  post_tasks:
      - name: Copy test zone
        with_items:
            - src: templates/nsd_conf_d/testzone.conf
              dest: '{{ nsd_conf_d }}/testzone.conf'
            - src: templates/nsd_zones/testzone
              dest: '{{ nsd_zones }}/testzone'
        template:
            src: '{{ item.src }}'
            dest: '{{ item.dest }}'
            owner: root
            group: 0
            mode: 0o0644
        notify:
            - Restart NSD
